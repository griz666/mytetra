<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Базовые настройки Ubiquiti EdgeOS: настройка NAT и Firewall</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />После того, как </span><a href="https://lanmarket.ua/ubiquiti-networks/ubiquiti-networks-edgerouter-lite-1801"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#0000ff;">EdgeRouter</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;"> (маршрутизатор)</span><span style=" font-family:'Sans Serif'; font-size:9pt;">, работающий под управлением сетевой операционной системы </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Ubiquiti EdgeOS</span><span style=" font-family:'Sans Serif'; font-size:9pt;">, настройкой которого мы занимаемся, получил доступ в интернет и локальная сеть была настроена, нам необходимо обеспечить выход в глобальную сеть интернет, для всех локальных устройств, объединенных в LAN.<br /><br />Поэтому в данной статье, мы рассмотрим настройку таких параметров как:<br />настройка NAT;<br />настройка Firewall;<br /><br />Делается это для того, чтобы дать возможность нескольким компьютерам, иметь доступ к сети интернет под одним внешним IP адресом, выделяемым провайдером и оградить локальную сеть от возможных атак из вне.<br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Настройка NAT</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />И начнем мы с того, что настроем преобразование сетевых адресов или попросту NAT (Network Address Translation). <br />Настроить NAT можно через GUI, для этого необходимо перейти на вкладку Security и там выбрать раздел NAT. После чего, надать кнопку + Add Source NAT Rule. И в открывшемся окне, заполнить поля, следующим образом:<br />Description - примечание, например Local NAT<br />Enable - поставить галочку<br />Outbound Interface - выбрать интерфейс, к которому у нас подключен провайдер, у нас eth0<br />Translation - выбрать Use Masquerade<br />Protocol - выбрать All protocols<br />Остальные поля, не трогаем.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image155550997500lfnwbc9k.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Сохраняем настройки, как всегда, кнопкой Save.<br /><br />Эту же процедуру, можно провести и при помощи консоли, для этого нужно набрать следующий ряд команд:<br /><br />ubnt@ubnt:~$ configure<br />[edit]<br />ubnt@ubnt# set service nat rule 5010 outbound-interface eth0<br />[edit]<br />ubnt@ubnt# set service nat rule 5010 type masquerade<br />[edit]<br />ubnt@ubnt# commit<br />[edit]<br />ubnt@ubnt# save<br />Saving configuration to '/config/config.boot'...<br />Done<br />[edit]<br />ubnt@ubnt# exit<br />exit<br />ubnt@ubnt:~$ configure<br />[edit]<br />ubnt@ubnt#</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><img src="image1555509975wm9nsqqd4q.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Настройка Firewall</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />Одним из основных рубежей безопасности вашей локальной сети, является Firewall, поэтому не стоит пренебрегать его настройкой. Ниже я приведу ряд основных правил для конфигурации межсетевого экрана для </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">EdgeRouter (</span><a href="https://lanmarket.ua/marshrutizatory"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#0000ff;">маршрутизатор</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">)</span><span style=" font-family:'Sans Serif'; font-size:9pt;">, работающим под управлением сетевой операционной системы </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Ubiquiti EdgeOS</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />Настроить Firewall можно как из web-интерфейса, так и из командной строки. Но учитывая что правил много, гораздо проще сделать это через консоль. Для этого, нужно задать ряд команд, перечисленных ниже:<br />ubnt@ubnt:~$ configure<br />[edit]<br />ubnt@ubnt# set firewall all-ping enable<br />[edit]<br />ubnt@ubnt# set firewall broadcast-ping disable<br />[edit]<br />ubnt@ubnt# set firewall conntrack-expect-table-size 4096<br />[edit]<br />ubnt@ubnt# set firewall conntrack-hash-size 4096<br />[edit]<br />ubnt@ubnt# set firewall conntrack-table-size 32768<br />[edit]<br />ubnt@ubnt# set firewall conntrack-tcp-loose enable<br />[edit]<br />ubnt@ubnt# set firewall ipv6-receive-redirects disable<br />[edit]<br />ubnt@ubnt# set firewall ipv6-src-route disable<br />[edit]<br />ubnt@ubnt# set firewall ip-src-route disable<br />[edit]<br />ubnt@ubnt# set firewall log-martians enable<br />[edit]<br />ubnt@ubnt# set firewall name LAN_IN default-action accept<br />[edit]<br />ubnt@ubnt# set firewall name LAN_LOCAL default-action accept<br />[edit]<br />ubnt@ubnt# set firewall name WAN_IN default-action drop<br />[edit]<br />ubnt@ubnt# set firewall name WAN_IN rule 1 action accept<br />[edit]<br />ubnt@ubnt# set firewall name WAN_IN rule 1 state established enable<br />[edit]<br />ubnt@ubnt# set firewall name WAN_IN rule 1 state related enable<br />[edit]<br />ubnt@ubnt# set firewall name WAN_IN rule 2 action drop<br />[edit]<br />ubnt@ubnt# set firewall name WAN_IN rule 2 log enable<br />[edit]<br />ubnt@ubnt# set firewall name WAN_IN rule 2 state invalid enable<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL default-action drop<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 1 action accept<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 1 state established enable<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 1 state related enable<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 2 action drop<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 2 log enable<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 2 state invalid enable<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 5 action accept<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 5 limit burst 1<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 5 limit rate 50/minute<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 5 log enable<br />[edit]<br />ubnt@ubnt# set firewall name WAN_LOCAL rule 5 protocol icmp<br />[edit]<br />ubnt@ubnt# set firewall receive-redirects disable<br />[edit]<br />ubnt@ubnt# set firewall send-redirects enable<br />[edit]<br />ubnt@ubnt# set firewall source-validation disable<br />[edit]<br />ubnt@ubnt# set firewall syn-cookies enable<br />[edit]<br />ubnt@ubnt# set interfaces bridge br0 firewall in name LAN_IN<br />[edit]<br />ubnt@ubnt# set interfaces bridge br0 firewall local name LAN_LOCAL<br />[edit]<br />ubnt@ubnt# set interfaces ethernet eth0 firewall in name WAN_IN<br />[edit]<br />ubnt@ubnt# set interfaces ethernet eth0 firewall local name WAN_LOCAL<br />[edit]<br />ubnt@ubnt# commit<br />[edit]<br />ubnt@ubnt# save<br />Saving configuration to '/config/config.boot'...<br />Done<br />[edit]<br />ubnt@ubnt# exit<br />exit<br />ubnt@ubnt:~$</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><img src="image1555509975g1iobyoqlv.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">И если все сделано правильно, все созданные правила, вы сможете увидеть в GUI на вкладке Security в разделе Firewall Polices.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><img src="image155550997501v2hiy8bn.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">А выбрав свойства конкретного правила, вы можете посмотреть полную статистику или даже внести определенные изменения, не прибегая к командной строке.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><img src="image1555509975s7q1ui71bs.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В конце, хочу привести полный список команд, который необходимо набрать в командной CLI, для создания всех необходимых правил и политик Firewall.<br /><br />configure<br />set firewall all-ping enable<br />set firewall broadcast-ping disable<br />set firewall conntrack-expect-table-size 4096<br />set firewall conntrack-hash-size 4096<br />set firewall conntrack-table-size 32768<br />set firewall conntrack-tcp-loose enable<br />set firewall ipv6-receive-redirects disable<br />set firewall ipv6-src-route disable<br />set firewall ip-src-route disable<br />set firewall log-martians enable<br />set firewall name LAN_IN default-action accept<br />set firewall name LAN_LOCAL default-action accept<br />set firewall name WAN_IN default-action drop<br />set firewall name WAN_IN rule 1 action accept<br />set firewall name WAN_IN rule 1 state established enable<br />set firewall name WAN_IN rule 1 state related enable<br />set firewall name WAN_IN rule 2 action drop<br />set firewall name WAN_IN rule 2 log enable<br />set firewall name WAN_IN rule 2 state invalid enable<br />set firewall name WAN_LOCAL default-action drop<br />set firewall name WAN_LOCAL rule 1 action accept<br />set firewall name WAN_LOCAL rule 1 state established enable<br />set firewall name WAN_LOCAL rule 1 state related enable<br />set firewall name WAN_LOCAL rule 2 action drop<br />set firewall name WAN_LOCAL rule 2 log enable<br />set firewall name WAN_LOCAL rule 2 state invalid enable<br />set firewall name WAN_LOCAL rule 5 action accept<br />set firewall name WAN_LOCAL rule 5 limit burst 1<br />set firewall name WAN_LOCAL rule 5 limit rate 50/minute<br />set firewall name WAN_LOCAL rule 5 log enable<br />set firewall name WAN_LOCAL rule 5 protocol icmp<br />set firewall receive-redirects disable<br />set firewall send-redirects enable<br />set firewall source-validation disable<br />set firewall syn-cookies enable<br />set interfaces bridge br0 firewall in name LAN_IN<br />set interfaces bridge br0 firewall local name LAN_LOCAL<br />set interfaces ethernet eth0 firewall in name WAN_IN<br />set interfaces ethernet eth0 firewall local name WAN_LOCAL<br />commit<br />save<br />exit<br /><br />На этом, основные базовые настройки </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">EdgeRouter (маршрутизатор)</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> и сетевой операционной системы </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Ubiquiti EdgeOS</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> в целом, можно считать оконченными. Единственное, что нам осталось, это сохранить имеющуюся у нас конфигурацию, на случай сбоев или других непредвиденных ситуаций. О том как сделать резервное копирование и восстановление, чиатйте в этой </span><a href="https://lanmarket.ua/stats/bazovye-nastroyki-Ubiquiti-EdgeOS:-sozdanie-rezervnoy-kopii-i-vosstanovlenie-konfiguracii"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">статье.</span></a></p></body></html>