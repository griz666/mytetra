<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Сейчас существует множество датчиков температуры и комбинированных, которые можно без проблем подключить к ESPhome и следовательно к Home Assistant. Достоинства датчиков Dallas esphome ds18b20 : в их компактности, точном измерении без подстройки, низкой стоимости и их можно подключить кучу на одну линию данных, а следовательно занять только один GPIO на esp8266 (esp32, Arduino или другом). Вы можете использовать эти датчики везде, где требуется измерять температуру, но я для первого теста применил их в котельной на коллекторе водяного теплого пола для отслеживания падения температур по веткам коллектора на обратке, чтобы точно управлять «расходом теплоносителя».</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">На коллектор теплого пола идет всего одна линия данных на все датчики. Плюс питание естественно. Далее крепим по одному датчику </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Dallas ds18b20</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> на каждую трубу обратки и один на подачу. Я не заморачивался и примотал датчики алюминиевым скотчем для систем вентиляции и сендвич-дымоходов из нержавейки.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Я последнее время люблю использовать модуль </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">esp-12f</span><span style=" font-family:'Sans Serif'; font-size:9pt;">  из за того, что в итоге экономиться место на плате и стоят они меньше, но чтобы не заморачиваться можно использовать nodemcu, wemos или любой другой контроллер. Заказываю  esp-12f  </span><a href="https://shopnow.pub/redirect/cpa/o/s4ngd380opnukkf4m8lyq45kuduczndt/?erid=2SDnjc4SVAG&amp;sub1=esp12f"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#0000ff;">за копейки здесь</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Естественно, что программный код предложенный в этой записи только для семейства ESP под </span><a href="https://moyteremok.ru/archives/3402"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">ESPhome</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;">. Если вы новичок рекомендую использовать nodemcu или wemos,  там уже распаяны все подтягивающие резисторы и главное есть USB интерфейс для прошивки без танцев с бубном.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Подключение ds18b20 к esphome</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Распиновка типового датчика:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1732348293lkli2skv8m.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Еще бывают версии в металлической колбочке типа герметичные (смотри картинку в заголовке записи), удобно, например, для заливки в стяжку теплого пола.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Рассмотрим подключение  датчиков dallas ds18b20 на примере </span><a href="https://shopnow.pub/redirect/cpa/o/s6t2g7fv40y643l9bbecxjwfgs7gf1jr/?erid=2SDnjcdAyon&amp;sub1=nodemcu"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; text-decoration: underline; color:#0000ff;">nodemcu</span></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1732348293k8511lvbpe.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Берем один или пачку датчиков. Подключаем питание. Подключаем линию данных к входу </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; font-style:italic;">GPIO5</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> (или к любому другому, только вносим изменения в код прошивки). Не забываем установить резистор на </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600; font-style:italic;">4.7КОм</span><span style=" font-family:'Sans Serif'; font-size:9pt;">.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Прошивка под esphome ds18b20</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Удобнее всего залить прошивку из установленного в Home Assistant компонента ESPhome. Тут есть нюанс, так как каждый датчик ds18b20 имеет уникальный адрес. Оно и понятно ведь у нас их будет куча на одной линии данных. Необходимо эти адреса узнать.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Настоятельно рекомендуется использовать </span><span style=" font-family:'monospace'; font-size:9pt;">address</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> атрибут для создания датчиков dallas, потому что если у вас на шине установлено несколько датчиков и автоматическое обнаружение датчиков завершается сбоем, индексы всех датчиков будут сдвинуты на единицу.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для этого сначала добавляем в код без конкретики:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">dallas:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">  - pin: GPIO05</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В логах смотрим адреса (уровень журнала должен быть установлен не ниже </span><span style=" font-family:'monospace'; font-size:9pt;">debug</span><span style=" font-family:'Sans Serif'; font-size:9pt;">!).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1732348293udig6prpkd.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Затем копируем эти адреса в свой код прошивки:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">dallas:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">  - pin: GPIO05 #пин к которому у вас подключена линия данных от ds18b20 </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:9pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">sensor:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">  - platform: dallas</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    address: 0xA40000031F055028  #подставляем свои адрес</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    name: &quot;Temperature_1&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">  - platform: dallas</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    address: 0xDD0000031EFB0428  #подставляем свои адрес</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    name: &quot;Temperature_2&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">  - platform: dallas</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    address: 0xBA0000031F0E5228  #подставляем свои адрес</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    name: &quot;Temperature_3&quot;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для того, чтобы понять какой адрес соответствует какому датчику, можно нагревать (или охлаждать) их по очереди и смотреть логи. Потом исправляем название (</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">name: «Temperature_1»</span><span style=" font-family:'Sans Serif'; font-size:9pt;">) под себя.</span></p></body></html>