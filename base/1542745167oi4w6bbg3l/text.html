<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="sites-page-title-header"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">1</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">8. Использование подпрограмм </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans Serif'; font-size:9pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="sites-canvas-main"></a><span style=" font-family:'Sans Serif'; font-size:9pt;">Д</span><span style=" font-family:'Sans Serif'; font-size:9pt;">о сих пор каждую новую программу мы писали в новом окне Small Basic. Это удобно и легко при отладке, но так мы не сможем сделать полноценный «телефон». Ведь на нем программы должны запускаться по клику на иконке на рабочем столе, а не по клику по файлу проекта Small Basic. <br /><br />Для встраивания написанных нами программ в «телефон», нужно научиться работать с подпрограммами. <br /><br />Объявление подпрограммы в общем виде выглядит так: <br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">Sub Имя</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><span style=" font-family:'monospace'; font-size:9pt;">' здесь инструкции подпрограммы</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><span style=" font-family:'monospace'; font-size:9pt;">EndSub </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Слово Sub (от англ. subprogram — подпрограмма) показывает, что далее следуют инструкции подпрограммы, слово EndSub отмечает конец подпрограммы. Идентификатор Имя определяет имя подпрограммы. <br /><br />Подпрограммы также логично использовать в больших программах, когда вам часто нужно выполнять одни и те же действия. Вот пример оформления написанного нами в прошлом уроке интерфейса калькулятора. <br /><br /></span><img src="image15427451492ve8omsc5e.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />Вызвать подпрограмму очень просто. Нужно всего лишь указать ее имя следующим образом: <br /><br />calc() <br /><br />Скобки означают, что это не переменная, а именно вызов подпрограммы. <br /><br />Сам код подпрограммы может быть написан в любом месте вашей программы, при вызове подпрограммы это не имеет значения. <br /><br />Теперь давайте вернемся ненадолго к нашему пользовательскому интерфейсу. Нам нужно связать клик по иконке приложения в «телефоне» с запуском подпрограммы. Работать с подпрограммами мы уже научились, осталось узнать, как отслеживать положение и действия мыши. <br /><br />Программа Small Basic может воспринимать следующие события: нажатие кнопки мыши, отпускание кнопки мыши, перемещение указателя мыши, нажатие клавиши клавиатуры. <br /><br />У каждого события есть имя: <br /><br />Событие Описание <br /><br />MouseDown Нажатие кнопки мыши <br /><br />MouseUp Отпускание кнопки мыши <br /><br />MouseMove Перемещение указателя мыши <br /><br />KyeDown Нажатие клавиши клавиатуры <br /><br />KeyUp Отпускание нажатой клавиши клавиатуры <br /><br />Для того чтобы программа реагировала на событие, необходимо написать процедуру обработки этого события и указать имя этой процедуры в качестве обработчика события. Процедура —обработчик задается путем присвоения значения соответствующему свойству: <br /><br />Часто программе необходима информация, в какой точке окна находился указатель мыши в момент нажатия кнопки мыши. Получить информацию о положении указателя мыши можно, обратившись к свойствам GraphicsWindow.MouseX и GraphicsWindow.MouseY. Именно этими свойствами нам и нужно воспользоваться. Давайте напишем условие вызова подпрограмм. Она должна вызываться, если будет произведен клик по иконке соответствующего приложения. Координаты иконки мы знаем, так что можем записать код. <br /><br />Для начала проассоциируем с кликом мышки подпрограмму, которая будет его обрабатывать. GraphicsWindow.MouseDown = mouse_click <br /><br />Теперь опишем процедуру запуска. <br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">Sub mouse_click</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><span style=" font-family:'monospace'; font-size:9pt;">' определяем координаты</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><span style=" font-family:'monospace'; font-size:9pt;">mouse_x = Mouse.MouseX - GraphicsWindow.Left</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><span style=" font-family:'monospace'; font-size:9pt;">mouse_y = Mouse.MouseY - GraphicsWindow.Top</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><span style=" font-family:'monospace'; font-size:9pt;">' запускаем калькулятор</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><span style=" font-family:'monospace'; font-size:9pt;">If mouse_x &gt; 133 And mouse_x &lt; 212 And mouse_y &gt;190 and mouse_y &lt; 270 then</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><span style=" font-family:'monospace'; font-size:9pt;">calc() </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Таким же образом можно прописать запуск для всех остальных программ, которые вы решите встроить в свой эмулятор.</span></p></td></tr></table></body></html>