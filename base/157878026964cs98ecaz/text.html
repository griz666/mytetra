<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Не работает wake on lan в linux, как настроить</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Wake_On_LAN"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">W</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">ake On LAN</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Немного заметок об особенностях работы Wake On LAN (WOL) в операционной системе Debian. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Содержание</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://wiki.debian.org/ru/WakeOnLan#Wake_On_LAN"><span style=" text-decoration: underline; color:#0000ff;">Wake On LAN</span></a></li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://wiki.debian.org/ru/WakeOnLan#A.2BBBAEPwQ.2FBDAEQAQwBEIEPQQwBE8_.2BBEcEMARBBEIETA-"><span style=" text-decoration: underline; color:#0000ff;">Аппаратная часть</span></a></li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://wiki.debian.org/ru/WakeOnLan#A.2BBB8EQAQ.2BBEgEOAQyBDoEMA_.2F_BIOS"><span style=" text-decoration: underline; color:#0000ff;">Прошивка / BIOS</span></a></li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://wiki.debian.org/ru/WakeOnLan#A.2BBCEEPgREBEI-"><span style=" text-decoration: underline; color:#0000ff;">Софт</span></a></li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://wiki.debian.org/ru/WakeOnLan#Conclusion"><span style=" text-decoration: underline; color:#0000ff;">Conclusion</span></a></li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://wiki.debian.org/ru/WakeOnLan#External_Links"><span style=" text-decoration: underline; color:#0000ff;">External Links</span></a></li></ol>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="A.2BBBAEPwQ.2FBDAEQAQwBEIEPQQwBE8_.2BBEcEMARBBEIETA-"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">А</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">ппаратная часть</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Ваш первый шаг к загрузке компьютера через сеть - убедиться, что ваша Ethernet-карта и материнская плата поддерживают какой-либо тип функции Wake On LAN. В особенности карты 3Com's маркировки -NM (non managed) не поддерживают WOL, тогда как карты маркировки -M (managed) поддерживают. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Есть две основные системы. Старый способ заключается в использовании 3-пинового коннектора Wake On LAN между вашей Ethernet-картой и материнской платой. Оба гнезда(англ.версия - &quot;headers&quot;) обычно именуются 'wol'. Более новая система использует Wake On LAN pin на PCI-шине, что устраняет необходимость в кабеле. Некоторые материнские платы поддерживают оба варианта и только предоставляют гнездо для обратной совместимости с Ethernet-картами, не поддерживающими PCI pin. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Более новые материнские платы с встроенными сетевыми картами поддерживают Wake On LAN без необходимости каких-либо выводов / кабелей. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="A.2BBB8EQAQ.2BBEgEOAQyBDoEMA_.2F_BIOS"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">П</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">рошивка / BIOS</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В хорошем BIOS в управлении питанием вы найдёте ясную, интуитивно понятную опцию &quot;Wake On LAN&quot;. К сожалению, моя система не была столь ясной и имела несколько возможных вариантов. один казался работающим всегда, остальные - временами. Я строил по информации заимствованной у Mark Ivey, т.к. У меня тоже есть Shuttle XPC SK41G и я успешно использую опцию &quot;PowerOn by PCI Card&quot;.</span><a name="fndef-8c26c761fd4d4d3d0bc5d11c2cffc8853917765b-0"></a><a href="https://wiki.debian.org/ru/WakeOnLan#fnref-8c26c761fd4d4d3d0bc5d11c2cffc8853917765b"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff; vertical-align:super;">1</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="A.2BBCEEPgREBEI-"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">С</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">офт</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="A.2BBB0EMARBBEIEQAQ.2BBDkEOgQw_.2BBDgEPQRCBDUEQAREBDUEOQRBBDA-"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Н</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">астройка интерфейса</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="stretch"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">s</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">tretch</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Добавьте этот файл: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1"></a><span style=" font-family:'monospace'; font-size:9pt;">$</span><span style=" font-family:'monospace'; font-size:9pt;"> cat /etc/network/interfaces.d/eth0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2"></a><span style=" font-family:'monospace'; font-size:9pt;">a</span><span style=" font-family:'monospace'; font-size:9pt;">uto eth0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-3"></a><span style=" font-family:'monospace'; font-size:9pt;">i</span><span style=" font-family:'monospace'; font-size:9pt;">face eth0 inet dhcp</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-4"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       ethernet-wol g</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">перезагрузитесь. Проверьте работу: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-1"></a><span style=" font-family:'monospace'; font-size:9pt;">$</span><span style=" font-family:'monospace'; font-size:9pt;"> sudo ethtool eth0</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:9pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-3-1"></a><span style=" font-family:'monospace'; font-size:9pt;">S</span><span style=" font-family:'monospace'; font-size:9pt;">ettings for eth0:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-4-1"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Supported ports: [ MII ]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-5"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Supported link modes:   10baseT/Half 10baseT/Full </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-6"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">                               100baseT/Half 100baseT/Full </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-7"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">                               1000baseT/Full </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-8"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Supported pause frame use: No</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-9"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Supports auto-negotiation: Yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-10"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Advertised link modes:  10baseT/Half 10baseT/Full </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-11"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">                               100baseT/Half 100baseT/Full </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-12"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">                               1000baseT/Full </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-13"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Advertised pause frame use: No</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-14"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Advertised auto-negotiation: Yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-15"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Speed: 100Mb/s</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-16"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Duplex: Full</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-17"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Port: MII</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-18"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       PHYAD: 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-19"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Transceiver: external</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-20"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Auto-negotiation: on</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-21"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Supports Wake-on: g</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-22"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Wake-on: g</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-23"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       Link detected: yes</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Директива </span><span style=" font-family:'monospace'; font-size:9pt;">Wake-on: g</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> означает, что всё работает. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Squeeze"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">S</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">queeze</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для </span><a href="https://wiki.debian.org/DebianSqueeze"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">Squeeze</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">ethtool</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> параметры могут быть установлены непосредственно из </span><span style=" font-family:'monospace'; font-size:9pt;">/etc/network/interfaces</span><span style=" font-family:'Sans Serif'; font-size:9pt;">. Результат выше может быть достигнут так:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-2"></a><span style=" font-family:'monospace'; font-size:9pt;">i</span><span style=" font-family:'monospace'; font-size:9pt;">face eth0 inet dhcp</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-2"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       ethernet-wol g</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Скрипт </span><span style=" font-family:'monospace'; font-size:9pt;">/etc/network/if-up.d/ethtool</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> будет заботиться о вызове </span><span style=" font-family:'monospace'; font-size:9pt;">ethtool</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> по ifup. Читайте </span><span style=" font-family:'monospace'; font-size:9pt;">/usr/share/doc/ethtool/README.Debian</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> для более полной информации. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Дальше можете выключить систему и приготовить остальные системы, чтобы разбудить её. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="A.2BBB8EPgRBBDsENQ_squeeze"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">П</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">осле squeeze</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">После аппаратной активации Wake On LAN также необходимо активировать его в программном обеспечении. Это делается с использованием программы </span><a href="https://packages.debian.org/ethtool"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">ethtool</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;">, которая говорит интерфейсу отвечать на волшебный пакет (the magic packet). Замените eth0 на имя вашего сетевого интерфейса: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-3"></a><span style=" font-family:'monospace'; font-size:9pt;">$</span><span style=" font-family:'monospace'; font-size:9pt;"> su</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-3"></a><span style=" font-family:'monospace'; font-size:9pt;">#</span><span style=" font-family:'monospace'; font-size:9pt;"> aptitude install ethtool</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-3-2"></a><span style=" font-family:'monospace'; font-size:9pt;">#</span><span style=" font-family:'monospace'; font-size:9pt;"> ethtool -s eth0 wol g</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Это можно автоматизировать с помощью записи в </span><span style=" font-family:'monospace'; font-size:9pt;">/etc/network/interfaces</span><span style=" font-family:'Sans Serif'; font-size:9pt;">: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-4"></a><span style=" font-family:'monospace'; font-size:9pt;">i</span><span style=" font-family:'monospace'; font-size:9pt;">face eth0 inet dhcp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-4"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       post-up /sbin/ethtool -s $IFACE wol g</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-3-3"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       post-down /sbin/ethtool -s $IFACE wol g</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Это запускает ethtool после каждого подъёма интерфейса eth0, а также после его отключения, таким образом WOL должен работать даже в случае, когда сеть отключена некорректно. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="A.2BBB4EQgQ.2FBEAEMAQyBDoEMA_WOL_.2BBEEEPgQ.2BBDEESQQ1BD0EOAQ5-"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">О</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">тправка WOL сообщений</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Я установил пакет </span><a href="https://packages.debian.org/etherwake"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">etherwake</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;"> в контролирующей системе для отправки &quot;Magic Packet&quot; к моему компьютеру для пробуждения. Программа должна быть запущена от имени root для отправки пакета (Я использую </span><a href="https://wiki.debian.org/sudo"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">sudo</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;"> для её запуска). </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-5"></a><span style=" font-family:'monospace'; font-size:9pt;">#</span><span style=" font-family:'monospace'; font-size:9pt;"> aptitude install etherwake</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-5"></a><span style=" font-family:'monospace'; font-size:9pt;">#</span><span style=" font-family:'monospace'; font-size:9pt;"> etherwake &lt;mac address&gt;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Также доступен </span><a href="https://packages.debian.org/wakeonlan"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">wakeonlan</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;"> - программа, использующая UDP-пакеты, а TCP, и не требующая прав root для запуска. Она также чуть более гибкая в настройке. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-6"></a><span style=" font-family:'monospace'; font-size:9pt;">#</span><span style=" font-family:'monospace'; font-size:9pt;"> aptitude install wakeonlan &amp;&amp; exit</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-6"></a><span style=" font-family:'monospace'; font-size:9pt;">$</span><span style=" font-family:'monospace'; font-size:9pt;"> wakeonlan &lt;mac address&gt;</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="WOL_.2BBEcEQwQyBEEEQgQyBDgEQgQ1BDsETAQ9BD4EQQRCBEw-"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">W</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">OL чувствительность</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Я нашёл, что не хочу каких-либо Wake On LAN настроек, за исключением Wake on &quot;Magic Packet&quot; (g). Я хочу только включать мою машину тогда, когда я ей это говорю, ни одноадресных (u), широковещательных (b) или многоадресных (m) сообщений. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="WOL_Persistence"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">W</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">OL Persistence</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Hardware looks up to spec, you think the BIOS is set right, but it still doesn't work without some tweaking using the software. According to the Wake On Lan client FAQ most Linux drivers disable the WOL feature on boot</span><a name="fndef-116545eae3461b7d9cd1bb9c8d161792b9eca82e-1"></a><a href="https://wiki.debian.org/ru/WakeOnLan#fnref-116545eae3461b7d9cd1bb9c8d161792b9eca82e"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff; vertical-align:super;">2</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;">, so we need to get it going. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Debugging_state_with_ethtool"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">D</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">ebugging state with ethtool</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">After an hour struggling with why my system still didn't work I started throwing in the </span><span style=" font-family:'monospace'; font-size:9pt;">ethtool</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> query command all over the place to see what the deal was: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-9"></a><span style=" font-family:'monospace'; font-size:9pt;">#</span><span style=" font-family:'monospace'; font-size:9pt;"> ethtool eth0</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ifup"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">i</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">fup</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">I found that (at least with my 8139too driver on Debian 3.1/Sarge) the install line was working when I'd </span><span style=" font-family:'monospace'; font-size:9pt;">modprobe 8139too</span><span style=" font-family:'Sans Serif'; font-size:9pt;">, but </span><a href="https://manpages.debian.org/man/8/ifup"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">ifup</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;"> also resets the WOL setting, so I added an up line to </span><span style=" font-family:'monospace'; font-size:9pt;">/etc/network/interfaces</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> under eth0: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-1-10"></a><span style=" font-family:'monospace'; font-size:9pt;">i</span><span style=" font-family:'monospace'; font-size:9pt;">face eth0 inet dhcp</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="line-2-7"></a><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt;">       up /sbin/ethtool -s $IFACE wol g</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">I kept the ethtool command in </span><span style=" font-family:'monospace'; font-size:9pt;">/etc/modprobe.d/local.conf</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> in case I boot and ifup isn't executed before shutting down. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Conclusion"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">C</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">onclusion</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Wake On LAN works on Debian and opens some new options up to me. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">I can log into my gateway and boot my desktop, grab what I need and then power it back off remotely. I'm using DHCP with MAC-to-IP mappings so I can look in that file on my gateway system to know the MAC address of the system I wish to wake up. If I didn't have that I could keep a text file. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">My next feat is to have non-essential systems power-off (not just halt) on a power outage to extend the battery runtime for the essential systems and then use WOL to power the other systems back on after power is restored and the battery has hit some specific charge level. I think some settings with halt or APM or ACPI are not right on those systems. See </span><a href="https://wiki.debian.org/OffAndOnAgain"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">OffAndOnAgain</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;">. </span></p></body></html>