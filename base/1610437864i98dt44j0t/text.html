<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="articlestitle"></a><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">O</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">penHAB2: Экспорт данных в MySQL и построение графиков в HABPanel</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В данной статье мы расскажем вам как добавить датчики в систему OpenHAB, настроить базу данных для эспорта, а также построить красивые графики по полученным данным. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Предположим, что у нас в комнате есть блок управления, который собирает данные с датчиков и отправляет их по протоколу MQTT на локальный сервер. Показания каждого датчика отправляются в отдельный MQTT канал, примерно вот так: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Датчик Dallas DS18b20 каждую минуту отправляет температуру в канал smartpot1/state/5/temp1. Датчик DHT-22 отправляет влажность воздуха в канал smartpot1/state/2/humi. Датчик влажности почвы отправляет каждые полчаса данные в канал smartpot1/state/a0. А также датчик уровня CO2 в воздухе отправляет свои данные в канал smartpot1/state/14/co2 каждую минуту. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">OpenHAB подключается к нашему MQTT серверу и подписывается на нужные каналы данных. Каждый канал данных добавляется в OpenHAB как отдельный элемент (Item). С этого момента каждый раз, когда на сервер MQTT приходят новые данные с датчиков, они сразу же появляются в OpenHAB и записываются в базу данных MySQL. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В графическом интерфейсе HabPanel мы создаем виджет, который будет брать показания счетчиков из базы данных и строить по ним графики. Графики будут автоматически обновляться по мере поступления новых показаний в базу данных. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Добавляем датчики в виде Items для OpenHAB</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Подключаемся по ssh или ftp к вашему Raspberry Pi (можно и к Orange Pi), на котором стоит OpenHAB, заходим в папку /etc/openhab2/items/ и открываем файл, в котором хранятся Items вашей системы, например, home.items или demo.items. Добавляем в него следующие строки:  </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Number SP1_Dallas1 &quot;Температура [%.1f °C]&quot; &lt;temperature&gt; {mqtt=&quot;&lt;[localbroker:smartpot1/state/5/temp1:state:default]&quot;}<br /><br />Number SP1_Dht22_Humi1 &quot;Влажность воздуха [%.1f %%]&quot; &lt;humidity&gt; {mqtt=&quot;&lt;[localbroker:smartpot1/state/2/humi:state:default]&quot;}<br /><br />Number SP1_Moist1 &quot;Влажность почвы c датчика [%s]&quot; &lt;garden&gt; {mqtt=&quot;&lt;[localbroker:smartpot1/state/a0:state:default]&quot;}<br /><br />Number SP1_Moist1pesr &quot;Влажность почвы в процентах [%.1f %%]&quot; &lt;garden&gt;<br /><br />Number SP1_CO2 &quot;Концентрация CO2 [%s ppm]&quot; &lt;carbondioxide&gt; {mqtt=&quot;&lt;[localbroker:smartpot1/state/14/co2:state:default]&quot;} </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для каждого датчика мы создаем элемент item типа Number. В скобках вида { ... } мы указываем через какой биндинг поступают данные, с какого сервера и по какому каналу. В нашем случае получается следующее: с помощью биндинга для протокола MQTT мы подключаемся к MQTT серверу localbroker, считываем данные из канала smartpot1/state/5/temp1 и присваиваем их нашему item. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для всех MQTT датчиков используется один и тот же код, только меняется название item'а и имя канала, в котором мы смотрим данные с датчика. Также для краcивого отображения в графическом интерфейсе мы прописали дополнительные параметры в описание элементов. [%s] - выводит просто полученное значение. [%.1f %%] - выводит значение с одним знаком после запятой, а также добавляется % после значения. [%.1f °C] - в этом случае после значения температуры добаляется °C . </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Хочу обратить ваше внимание на то, что названия брокеров, к которым мы подключаемся, могут быть разным. В нашем случае брокер называется &quot;localbroker&quot;. Это значит, что мы в настройках предварительно добавили mqtt сервер, прописали его IP адрес, логин, пароль для подключения и назвали его localbroker. Дальше мы везде в системе обращаемся к нему по имени - localbroker. Если у вас большая сеть датчиков с несколькими MQTT серверами, то OpenHAB может работать сразу с несколькими серверами. Необходимо будет в конфиге указать все MQTT сервера и дальше обращаться к ним просто по именам. Скоро у нас на сайте появится отдельная статья про настройку связи между OpenHAB и MQTT сервером.  </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для датчика влажности почвы мы используем два разных элемента - SP1_Moist1 и SP1_Moist1pesr. Дело в том, что датчик влажности почвы, подключенный на аналоговый вход платы управления, может работать по-разному. У одних производителей чем больше влажность почвы, тем выходное значение больше. У других наоборот: чем больше влажность почвы, тем выходное значение ниже. Мы будем принимать данные с датчика в том виде как они есть, а потом будем рассчитывать процент влажности исходя из минимума и максимума, и записывать его в SP1_Moist1pesr. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Сохраняем изменения в файле items и закрываем его. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для каждого датчика мы добавили элемент в систему OpenHAB. Данные приходят и отображаются в системе, но они нигде не сохраняются. Чтобы проводить аналитику и строить графики мы установим базу данных и настроим связь сисстемы OpenHAB с этой базой. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Создание и подключение базы данных MySQL</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">1. Первым делом необходимо открыть OpenHAB в вашем браузере (ip адрес вашего сервера:8080, например, 192.168.1.10:8080), выбрать Paper UI, перейти в раздел Add-ons и выбрать вкладку Persistence. В поиске вводите MySQL и устанавливаете &quot;MySQL Persistence&quot;. В списке будет 2 расширения для работы с MySQL, вам необходимо установить только MySQL Persistence. Если у вас очень долго устанавливается это дополниение - просто обновите страницу и вы увидите, что оно уже добавилось в систему. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">2. Теперь необходимо установить саму базу данных. Снова подключаемся к нашему Raspberry Pi по SSH через консоль и вводим: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">sudo apt-get install mysql-server </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">После того, как база установилась, вводим следующую команду, чтобы запустить сервер базы данных mysql с правами администратора: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">sudo mysql -u root -p </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Вы успешно вошли в программу mysql, которая позволяет работать с базами данных. Создадим базу данных для нашего OpenHAB: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">CREATE DATABASE OpenHAB; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Здесь &quot;OpenHAB&quot; - это название самой базы данных, вы можете назвать ее по-другому, главное потом не забыть, как вы её назвали. Обратите внимание, что на конце всех команд для MySQL должен быть знак &quot;;&quot;. Теперь создадим пользователя для работы с базой данных и назначим ему полные права для доступа к этой базе данных: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">CREATE USER 'openhab'@'localhost' IDENTIFIED BY 'YOURPASSWORD';<br />GRANT ALL PRIVILEGES ON OpenHAB.* TO 'openhab'@'localhost'; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Как вы видите, здесь мы создали пользователя с именем openhab и паролем YOURPASSWORD, дали ему полные права доступа к базе с названием OpenHAB. Вы можете поменять название и пароль на другие, эти данные будут использоваться системой только для подключения OpenHAB к базе.  </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Выходим из программы MySQL: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">quit </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Останавливаем и снова запускаем OpenHAB через консоль: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">sudo service openhab2 stop<br />sudo service openhab2 start </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">3. После окончания загрузки системы у нас появится новый файл настроек. Через ssh или ftp заходим в папку /etc/openhab2/services, открываем файл mysql.cfg и вставляем в него следующий код: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"># the database url like 'jdbc:mysql://&lt;host&gt;:&lt;port&gt;/&lt;database&gt;' (without quotes)<br />url=jdbc:mysql://127.0.0.1:3306/OpenHAB<br /><br /># the database user<br />user=openhab<br /><br /># the database password<br />password=YOURPASSWORD </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Мы прописали название базы данных, которую только что создали, а также пользователя и пароль от нее. Сохраняем и закрываем. С этого момента OpenHAB подключен к базе данных и может записывать туда данные. Осталось только указать, как именно он это будет делать. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Предварительные настройки закончились, переходим непосредственно к экспорту данных в базу. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Настраиваем MySQL Persistence</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">По ssh или ftp заходим в папку /etc/openhab2/persistence/ и правим файл mysql.persist: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Strategies {<br />       everyMinute    : &quot;0 * * * * ?&quot;<br />       every5Minutes : &quot;0 */5 * * * ?&quot;<br />       everyHour   : &quot;0 0 * * * ?&quot;<br />       everyDay    : &quot;0 0 0 * * ?&quot;<br />       default = everyChange<br />}<br /><br />Items {<br />       SP1_Dallas1 : strategy = everyChange, everyDay, restoreOnStartup<br />       SP1_Dht22_Humi1 : strategy = everyChange, everyDay, restoreOnStartup<br />       SP1_Moist1pesr : strategy = everyChange, everyDay, restoreOnStartup<br />       SP1_CO2 : strategy = everyChange, everyDay, restoreOnStartup<br />} </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В первой части файла с помощью специальной разметки мы задаем стратегии добавления данных в базу, например, каждую минуту, кадый час, каждый день и так далее. По умолчанию используется стратегия everyChange - при каждом изменении. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Во второй части файла мы указываем наши Items и для каждого из них указываем стратегии добавелния в базу данных. Данные с датчиков будут добавляться в базу при каждом обновлении. restoreOnStartup - используется для восстановления значения переменной после перезагрузки OpenHAB. Кроме данных с датчиков тут можно хранить статусы выключателей. В этом случае после перезагрузки OpenHAB всегда будет точно знать в каком состоянии были выключатели. Сохраняем изменения и закрываем файл. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Каждый раз, когда вам неободимо будет, чтобы значения какого-то элемента хранилось в базе или и по ним строились графики - необходимо добавлять item в этот файл и прописывать ему стратегии экспорта. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Проверка работы экпорта данных</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Первым делом необходимо по ssh или ftp зайти в файл /etc/openhab2/persistence/mysql.persist и убедиться, что у вас прописаны стратегии экспорта данных как описано выше. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Чтобы точно знать, записываются ли данные с датчиков в базу данных, нам необходимо войти в программу MySQL и посмотреть наличие данных в соответствующих таблицах. Для начала необходимо проверить работу сервиса MySQL. Подключаемся к вашему Pi по ssh и вводим: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">/etc/init.d/mysql status </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Если в ответном сообщении вы видите active (running), то все в порядке. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16104378071w9xxpzp9c.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Теперь необходимо войти в MySQL под пользователем root, для этого набираем: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">mysql -u root -p </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">И вводим пароль администратора от вашего Pi. Вы увидите приветственный экран программы MySQL: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807mz4badxjkj.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Набираем следующую команду, чтобы увидеть список баз данных. Обратите внимание, что в конце каждой команды в MySQL должен стоять знак &quot;;&quot;. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">show databases; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В ответ терминал выдаст нам список доступных баз данных: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807tn26aubvjj.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Переходим в ту базу данных, в которой у нас хранятся данные из OpenHAB: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">use OpenHAB; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В ответ получим &quot;Database changed&quot;. В MySQL данные с датчиков хранятся следующим образом: для каждого item из OpenHAB в базе данных создаётся таблица, в которой хранятся данные. Обычно в такой таблице всего две колонки: дата добавления и само значение переменной. Чтобы посмотреть список таблиц, вводим следующую команду: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">show tables; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В ответ мы получаем список доступных таблиц: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807l0vad90sy9.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для каждого экпортируемого item у нас есть опеределенная таблица, но они скрыты порядковыми номерами. Чтобы понять, какая таблица соответствует нужному нам item, существует таблица &quot;items&quot;, в которой расписаны соответствия таблиц и items. Чтобы ее посмотреть, вводим: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">select * from Items; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В ответ получаем список таблиц + идентификаторов items: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image161043780740ppsf2pe2.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Если экспорт настроен правильно, то в этом списке вы должны увидеть свои экспортируемые items. Если нужного items в списке нет, то стоит попробовать удалить и заново добавить нужную строчку в файл /etc/openhab2/persistence/mysql.persist, а также перезапустить mysql и openhab. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">При экспорте в MySQL может возникнуть другая распостраненная проблема: таблица данных есть, но данные туда не записываются. Это может произойти, если вы несколько раз включали и выключали экспорт данных для какого-то item. Для устранения данной проблемы проверим записываются ли данные в таблицу: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">select * from Item1; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Этой командой мы выводим все данные из таблицы Item1, в которой у нас хранятся показатели с датчика CO2. Выглядит это примерно вот так: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807onprag1lb0.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Если вы видите в таблице данные со свежими датами, значит вы все настроили правильно и можете переходить к построению графиков. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Если свежих данных в таблице нет, то необходимо сделать следующие действия. Удалить все данные из таблицы нашего item командой &quot;delete from Item1;&quot; после чего заново прописываем правила экпорта в файле /etc/openhab2/persistence/mysql.persist, а также перезапускаем mysql и openhab. Если это не поможет, то можно попробовать удалить всю таблицу из базы данных командой &quot;DROP TABLE Item1;&quot;, а потом также заново настроить экпорт данных. Как только данные начнут поступать в базу данных - система сделает для них новую таблицу. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Строим графики в HabPanel</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Все предварительные настройки закончены и мы можем переходить непосредственно к построению графиков. Одним из самых удобных способов создания и редактирования графиков в OpenHAB является графический интерфейс HabPanel. Открываем главную страницу OpenHAB2 и переходим в HabPanel. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Если у вас в списке графических интерфейсов нет HabPanel, то его можно поставить в Paper UI во вкладке User Interfaces в разделе Add-ons. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Заходим в HabPanel и в правом верхнем углу нажимаем на иконку настроек, выбираем &quot;Add Dashboard&quot; и во всплывающем окне вводим название нашего экрана с графиками. Я назвал его SmartPot2. Теперь нажимаем на иконку в верхнем левом углу и выбираем наш новый экран из списка. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Вы увидите экран для информационных виджетов. Все экраны в HabPanel могут находиться в режиме редактирования или в режиме работы. В режиме редактирования отображается несколько кнопок: список экранов, сохранить конфигурации, запустить экран в режим выполнения и кнопка добавления виджетов. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807sajxzbch16.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для начала добавим несколько информационных виджетов, чтобы отслеживать текущие показатели с датчиков. Для этого нажимаем кнопку &quot;Add Widget&quot; и выбираем Dummy в списке. Появится текстовый виджет. Его размер можно менять растягивая его за уголок. Для настройки выводимых данных нажимаем на кнопку настроек на виджете и выбираем &quot;Edit&quot;. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807kpupwk5y5w.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В открывшемся окне вводим название виджета, выбираем данные какого item будут выводиться, а также указываем формат данных (для датчика CO2 укажем %s ppm). Также мы могли бы указать размер шрифта и иконку, которая будет выводиться рядом с данными. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807ypozlrsqty.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Нажимаем кнопку &quot;Save&quot;, и новый виджет добавляется на экран. Для запуска экрана в рабочий режим нажимаем кнопку &quot;Run&quot;. Мы получили виджет, который показывает нам концентрацию CO2 в воздухе. Он обновляется каждый раз, когда OpenHAB получает данные с датчика. Сама страница при этом не перезагружается. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image161043780791pty44aml.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для возврата в режим редактирования наведите мышку на название экрана. Рядом с ним появится карандаш. Нажмите на него, и вы снова в режиме редактирования. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Добавьте виджеты для всех 4х датчиков. Для температуры воздуха можно использовать формат данных %.1f °C, для влажности воздуха и почвы %.1f %% чтобы выводить данные в процентах. Нажимаем кнопку &quot;Run&quot; и получаем удобную панель с показаниями всех датчиков. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807xmb7r7rdlw.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Теперь, когда мы видим данные с датчиков, мы можем перейти непосредственно к построению графиков. Переходим в режим редактирования экрана и добавляем новый виджет типа Chart. Растягиваем его на всю ширину экрана и переходим в настройки. Для начала мы добавим график влажности почвы. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807p01ezn5rte.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В первом окне мы вводим название графика, выбираем тип n3-line-chart (именно этот тип позволит нам строить красивые интерактивные графики), вводим сервис экспорта даных mysql и выбираем период, за который будут отображаться данные. Влажность почвы изменяется достаточно медленно, поэтому я выбрал неделю - W. Сохраняем изменнения, снова открываем настройки виджета и переходим во вкладку Axis. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image161043780763gvcezw51.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В данной вкладке мы можем настраивать, какие оси будут отображаться по краям графика. Это очень удобно, потому что в HabPanel мы можем выводить данные с нескольких датчиков на один график. Например, влажность воздуха и температуру или 2-3 графика температуры.  </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Левую ось мы можем настроить как ось для влажности воздуха, а правую для тепературы. Если мы планируем выводить на графике только один параметр, то можно сделать оси одинаковыми, чтобы слева и справа от графика у нас была одинаковая шкала. Так мы и сделаем для графика влажности почвы. Для обоих осей мы укажем минимальное значение разное 0, а максимальное равное 100. Также отметим галочку &quot;Include zero&quot;. Если этот параметр отмечен, то минимальным значением на шкале является 0. Если же этот параметр не отмечен, то минимальным значением на шкале будет минимальное значение графика за указанный период. Если параметр не отмечен и в течении недели влажность почвы не падала ниже 30%, то 30% будет минимальным значением на боковой шкале. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Переходим во вкладку Series: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807i239pvwgoy.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">В данной вкладке мы можем выбрать данные каких датчиков нам необходимо выводить на графике. Нажимаем на &quot;+&quot;. Выбираем по какой оси будет строиться график, вводим название, выбираем для какого item будут выводиться данные на графике, выбираем цвет и тип графика в строчке Display. Line - рисовать линию обводки, Area - закрашивать область под графиком, Dots - рисовать на графике контрольные точки. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Галочка &quot;Live update&quot; отвечает за то, чтобы графики обновлялись без обновления страницы. Это очень удобно! Сохраняем и нажимаем кнопку &quot;Run&quot; вверху экрана с виджетами. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807sdytrxwc4q.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Когда у вас накопится достаточное количество данных в базе, график будет выглядеть примерно так. При наведении мышкой на определенную точку на графике, будет показано время и значение переменной. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">ВНИМАНИЕ!</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> Правила экспорта данных настроены так, что новые точки на графике появляются только при изменении показаний датчиков. Если датчик температуры лежит в комнате с постоянной температурой, то график не будет отображаться пока температура не изменится. Так же дела обстоят с временем обновления. Если у вас данные с датчика приходят раз в час, то пока не придут первые новые показатели - график будет пустым. Перед созданием первых графиков постарайтесь накопить данные в базе данных, настроить датчик так, чтобы данные с него приходили часто, а также чтобы была возможность быстро изменить показатели, которые замеряет датчик. Это поможет вам избежать части проблем, связанных с нерабочими графиками. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Дальше мы можем настроить график для датчика CO2. Для этого добавляем новый вижет и прописываем у него следующие параметры: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807ra97511lxm.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807mv4q4t1h9p.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807fh2draqnma.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Когда накопится достаточно данных, мы получим следующий график, на котором отлично видно как начинает падать уровень CO2 при открытии окна. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807ttlig6jirh.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Также на графике вы можете отображать, например, температуры в разных комнатах: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807kucp0xi1u8.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Кроме графиков нескольких переменных мы можем выводить пометки о событиях. Например, на графике CO2 мы можем выводить метку о том, когда было открыто или закрыто окно.  </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Предположим, что у нас есть датчик открытия окна. В системе OpenHAB в файле /etc/openhab2/items/home.items он прописан следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Contact    WindowsSensor1   &quot;Окно кабинет&quot; &lt;window&gt; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Этот элемент мы не может выводить на графике, но мы можем добавить переменную, которая будет равна 1 если мы открыли окно и 0 если мы закрыли окно. Для этого в файл home.items мы добавил еще один элемент: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Number   WindowsSensorChart1   &quot;Открытие каб [%s]&quot; &lt;window&gt; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для того, чтобы переменная принимала разные значения в зависимости от состояния окна, мы добавим новое правило в файл /etc/openhab2/rules/home.rules </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">rule &quot;Windows Sensor Cabinet chart&quot;<br />when<br />    Item WindowsSensor1 changed<br />then<br />    if(WindowsSensor1.state == OPEN ) {<br />        sendCommand(WindowsSensorChart1, 1)    <br />    }<br />    if(WindowsSensor1.state == CLOSED ) {<br />        sendCommand(WindowsSensorChart1, 0)    <br />    }<br />end </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Чтобы данная переменная выводилась на графике, нам необходимо прописать правило её экспорта в базу данных: заходим в файл /etc/openhab2/persistence/mysql.persist и добавляем строчку: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">WindowsSensorChart1 : strategy = everyChange, everyDay, restoreOnStartup </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Теперь информация об открытии и закрытии окна пишется в базу, и нам остается только вывести ее на графике. Заходим в HabPanel, переходим на экран SamrtPot2, включаем режим редактирования, открываем настройки графика CO2 и переходим во вкладку Axis. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image161043780769p82gy841.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Для переменной, отображающей состояние датчика открытия окна, мы добавляем дополнительную ось. Минимальное значение будет 0, максимальное 2. Вторая ось используется для отображения уровня CO2. Переходим во вкладку Series и добавляем на график еще одну переменную: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807idu3wbqf9x.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Сохраняем и нажимаем кнопку &quot;Run&quot; на нашем экране HabPanel. График начнет обновляться. Теперь каждый раз, когда вы будете открывать или закрывать окно на графике будет появляться дополнительная точка.  </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1610437807ct75i7ih8c.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Теперь по синим точкам на графике отлично видно, в какой момет окно закрыли, и уровень CO2 начал расти, а в какой момент окно открыли, и уровень CO2 стал падать. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Правила очень удобно использовать для вывода событий на графиках. Этими событиями могут быть как открытия разных окон, так и включения каких-то приборов. Также правила удобно использовать, если нам необходимо разбить график на интервалы. Например, мы можем выводить дневной и ночной расход электроэнергии разными цветами.</span></p></body></html>