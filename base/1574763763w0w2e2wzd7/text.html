<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ВНИМАНИЕ!!! пароль на &quot;клиентах&quot; должен указываться для порта, не для ромон в целом. Иначе не видит подключения.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans Serif'; font-size:9pt; font-weight:600;"><br /></p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Гайд по Mikrotik RoMON </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/hub/sys_admin/"><span style=" text-decoration: underline; color:#0000ff;">Системное администрирование</span></a>, </li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/hub/network_hardware/"><span style=" text-decoration: underline; color:#0000ff;">Сетевое оборудование</span></a> </li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="post-content-body"></a><span style=" font-family:'Sans Serif'; font-size:9pt;">У</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> всех бывали ситуации, когда необходимо настроить удаленное оборудование(иногда новое), а доступ имеется только к другим сетевым девайсам, никаких ПК/Ноутбуков и пользователей с телефонами. В случае с Mikrotik эту проблему можно решить двумя путями: встроенный в RouterOS mac-telnet и RoMON. О них и пойдет речь ниже.<br /></span><a name="habracut"></a><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Mac Telnet с роутера</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Для тех кто забыл: Mac telnet работает на Layer2, поэтому подключение возможно в пределах одного сегмента сети.</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br /></span><img src="image1574763734giibrnceds.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />Подключаемся по winbox или ssh к настроенному роутеру(Mkt1) и через него по mac-telnet к новому(Mkt2).<br /><br />Где найти mac-telnet:<br /><br />* [IP]-&gt;[Neighbors] — если включено обнаружение соседей<br />* [IP]-&gt;[ARP] — если на новом роутере есть какой-то ip и он резолвится в mac<br />* [Tools]-&gt;[Telnet] — тут помимо mac-telnet есть обычный telnet и ssh<br />* /tool mac-telnet — из консоли<br /><br /></span><img src="image15747637349x4eck7gzf.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br /></span><img src="image15747637347jio7dtk5g.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">Что стоит помнить: если на устройстве присутствует дефолтная конфигураци, то mac-telnet будет доступен только на lan портах(все кроме ether1, обычно), так что явно говорите монтажникам куда подключать кабель, иначе никакой mac-telnet и RoMON вам не поможет.</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />Доступ есть, можно настраивать, но ведь хочется удобства? Особенно при настройке деревьев очередей и большого числа правил фаервола.<br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Подключение через RoMON</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />RoMON(Router Management Overlay Network) — Возможность использовать одно устройство mikrotik к которому есть доступ по ip в качестве транзита для подключения к устройству по mac.<br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline;">RoMON отключен по умолчанию</span><span style=" font-family:'Sans Serif'; font-size:9pt;">. Клиентская часть встроена в winbox, так что ничего доустанавливать не потребуется.<br /><br />Настройка на транзитном роутере (Mkt1):<br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">[Tools]-&gt;[RoMON]</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />* Enabled — Включение RoMON<br />* ID — Ручная установка RoMON ID, по умолчанию выбирается один из mac адресов роутера<br />* Secrets — Набор паролей для аутентификации по RoMON, используются, если явно не указан пароль на порту. На </span><a href="https://wiki.mikrotik.com/wiki/Manual:RoMON#Secrets"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">wiki </span></a><span style=" font-family:'Sans Serif'; font-size:9pt;">подробна расписана процедура выбора пароля.<br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">[Tools]-&gt;[RoMON]-&gt;[Ports]</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />По дефолту включены ВСЕ порты, что не особо безопасно и отключить all не представляется возможным, так что устанавливаем у него </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Forbid=yes</span><span style=" font-family:'Sans Serif'; font-size:9pt;">, более точные правила для интерфейсов перекроют all.<br /><br />Создаем правило для ether4:<br /><br />* Interface — порт для которого производим натсройки<br />* Forbid — запретить работу RoMON на интерфейсе<br />* Cost — учитывается при построении пути в больших герляндах<br />* Secrets — Набор паролей для аутентификации<br /><br /></span><img src="image1574763734dlyvxqyp4b.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span><img src="image1574763734xto27hmfx1.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span><img src="image1574763734ukkso76hrb.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />Консольный вариант:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">/tool romon</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">set enabled=yes id=00:00:00:00:00:10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">/tool romon port</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">set [ find default=yes ] forbid=yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">add disabled=no interface=ether4 secrets=test-for-romon</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:9pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Настройка на удаленном роутере (Mkt2):<br />Тут у нас подключение по mac-telnet, так что и настройки будут консольными:<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">/tool romon</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">set enabled=yes id=00:00:00:00:00:20</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">/tool romon port</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">set [ find default=yes ] forbid=yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">add disabled=no interface=ether5 secrets=test-for-romon</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:9pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Теперь в </span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">[Tools]-&gt;[RoMON]-&gt;[Discovery]</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> на Mkt1 мы видим соседа:<br /><br /></span><img src="image1574763734xkcwg9muf6.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-style:italic;">И еще одного соседа, который подключен транзитом через Mkt2, оставляю настройку этого соединения в качестве самостоятельного задания, все аналогично.</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Подключение</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />Запускаем Winbox и коннектимся к 2.2.2.2 в режиме RoMON используя обычную учетную запись и пароль, secrets в RoMON относится только к связи между роутерами:<br /><br /></span><img src="image15747637346c0au7rwm5.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />И тут мы видим самое интересное — все роутеры в цепочке RoMON доступны для подключения через единственный транзитный Mikrotik.<br /><br /></span><img src="image1574763734xxpxpe5bbc.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />Выбираем один из адресов(RoMON ID) и подключаемся к интересующему роутеру.<br /><br /></span><img src="image1574763734mpxzltonn3.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br />Итог: Получаем прозрачный доступ до всех роутеров в цепочке, без необходимости последовательного логина через mac-telnet.<br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Дополнительно</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">[Tools]-&gt;[RoMON]-&gt;[Ping]</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> — утилита для пинга роутеров по RoMON ID.<br /><br />Обычный mac-telnet не является безопасным каналом связи, при наличии RoMON можно устанавливать ssh подключение по RoMON ID.<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">/tool romon ssh &lt;romon id&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Подключение через RoMON в режиме коммандной строки(для ярлыков):<br /><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">winbox.exe --romon &lt;RouterIP&gt; &lt;RoMON ID&gt; &lt;user&gt; &lt;password&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />На этом все. Функционал не для повседневного использования, но полезно о нем помнить и знать как настроить.</span></p></body></html>