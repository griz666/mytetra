<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">How to add network bridge with nmcli (NetworkManager) on Linux</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">I am using Debian Linux 9 “stretch” on the desktop. I would like to create network bridge with NetworkManager. But, I am unable to find the option to add br0. How can I create or add network bridge with nmcli for NetworkManager on Linux?<br /></span><a name="more-146739"></a><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><span style=" font-family:'Sans Serif'; font-size:9pt;">A bridge is nothing but a device which joins two local networks into one network. It works at the data link layer, i.e., layer 2 of the OSI model. Network bridge often used with virtualization and other software. Disabling NetworkManager for a simple bridge especially on Linux Laptop/desktop doesn’t make any sense. The nmcli tool can create Persistent bridge configuration without editing any files.</span><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;"> This page shows how to create a bridge interface using the Network Manager command line tool called nmcli</span><span style=" font-family:'Sans Serif'; font-size:9pt;">.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">How to create/add network bridge with nmcli</span><span style=" font-family:'Sans Serif'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">The procedure to add a bridge interface on Linux is as follows when you want to use Network Manager:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Open the Terminal app</li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Get info about the current connection:<br /><span style=" font-family:'monospace'; font-weight:600;">nmcli con show</span></li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Add a new bridge:<br /><span style=" font-family:'monospace'; font-weight:600;">nmcli con add type bridge ifname br0</span></li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Create a slave interface:<br /><span style=" font-family:'monospace'; font-weight:600;">nmcli con add type bridge-slave ifname eno1 master br0</span></li>
<li style=" font-family:'Sans Serif'; font-size:9pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Turn on br0:<br /><span style=" font-family:'monospace'; font-weight:600;">nmcli con up br0</span></li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Let us see how to create a bridge, named br0 in details.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Get current network config</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">You can view connection from the Network Manager GUI in settings:<br /></span><img src="image1607846245n1uxlkr5pg.png" /><img src="image1607846245gc26euxlqo.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Another option is to type the following command:<br /></span><span style=" font-family:'monospace'; font-size:9pt;">$ nmcli con show<br />$ nmcli connection show --active </span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><img src="image1607846245iquhq68s9x.png" /><img src="image16078462457wei9g20l7.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />I have a “Wired connection 1” which uses the eno1 Ethernet interface. My system has a VPN interface too. I am going to setup a bridge interface named br0 and add, (or enslave) an interface to eno1.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">How to create a bridge, named br0</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">$ sudo nmcli con add ifname br0 type bridge con-name br0<br />$ sudo nmcli con add type bridge-slave ifname eno1 master br0<br />$ nmcli connection show</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><img src="image1607846245wijy4xshyj.png" /><img src="image16078462455gpzdwmmov.png" /><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />You can disable STP too:<br /></span><span style=" font-family:'monospace'; font-size:9pt;">$ sudo nmcli con modify br0 bridge.stp no<br />$ nmcli con show<br />$ nmcli -f bridge con show br0</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />The last command shows the bridge settings including disabled STP: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">bridge.mac-address:                     --</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">bridge.stp:                             no</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">bridge.priority:                        32768</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">bridge.forward-delay:                   15</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">bridge.hello-time:                      2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">bridge.max-age:                         20</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">bridge.ageing-time:                     300</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">bridge.multicast-snooping:              yes </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">How to turn on bridge interface</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">You must turn off “Wired connection 1” and turn on br0:<br /></span><span style=" font-family:'monospace'; font-size:9pt;">$ sudo nmcli con down &quot;Wired connection 1&quot;<br />$ sudo nmcli con up br0<br />$ nmcli con show</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Use </span><a href="https://www.cyberciti.biz/faq/linux-ip-command-examples-usage-syntax/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">ip command</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;"> to view the IP settings:<br /></span><span style=" font-family:'monospace'; font-size:9pt;">$ ip a s<br />$ ip a s br0</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span><img src="image1607846245zcrtuh9chb.png" /><img src="image1607846245ke9jcdh5vv.png" /></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt; font-weight:600;">Optional: How to use br0 with KVM </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Now you can connect VMs (virtual machine) created with KVM/VirtualBox/VMware workstation to a network directly without using NAT. Create a file named br0.xml for KVM using vi command or </span><a href="https://www.cyberciti.biz/faq/linux-unix-appleosx-bsd-cat-command-examples/"><span style=" font-family:'Sans Serif'; font-size:9pt; text-decoration: underline; color:#0000ff;">cat command</span></a><span style=" font-family:'Sans Serif'; font-size:9pt;">:<br /></span><span style=" font-family:'monospace'; font-size:9pt;">$ cat /tmp/br0.xml</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Append the following code: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">&lt;network&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">  &lt;name&gt;br0&lt;/name&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">  &lt;forward mode=&quot;bridge&quot;/&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">  &lt;bridge name=&quot;br0&quot; /&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">&lt;/network&gt; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">Run virsh command as follows:<br /></span><span style=" font-family:'monospace'; font-size:9pt;"># virsh net-define /tmp/br0.xml<br /># virsh net-start br0<br /># virsh net-autostart br0<br /># virsh net-list --all</span><span style=" font-family:'Sans Serif'; font-size:9pt;"><br />Sample outputs: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> Name                 State      Autostart     Persistent</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">----------------------------------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> br0                  active     yes           yes</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> default              inactive   no            yes </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;">For more info read the following man page:<br /></span><span style=" font-family:'monospace'; font-size:9pt;">$ man ip<br />$ man nmcli</span></p></body></html>