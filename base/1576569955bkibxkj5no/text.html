<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Установка человеческой Java/JDK в Ubuntu 12.04 Precise</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">Никогда бы не подумал, что придется писать подобные мануалы, тем более для себя… Но, пути копирастов неисповедимы.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Собственно. Если кто не в курсе, то в какой-то момент компаниякоторуюнельзяназывать изменила лицензионное соглашение для JDK так, что её стало невозможно распространять через линуксячьи репозитории.<br />OpenJDK, который остался в репозиториях — полный шлак и не умеет даже запускать KVM-ные апплеты. Очень многие.<br />Тем временем jdk делает огромные шаги, вышла уже 7я версия (шустрее, выше, сильнее, а главное, что нет проблем с доступом к ipmi/ip-kvm вообще никаких).<br />Вот только процесс установки теперь для убунтоводов несколько нетривиален.<br />Ну а поскольку сам я сижу под бубунтой — мне он тоже пригодится. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Самое паршивое, что теперь она не будет обновляться при apt-get update. Ну то, что оракловцы мудаки — мы уже давно знаем. Ставить её всё равно нужно. Они настолько мудаки, что теперь нельзя найти даже статическую ссылку на последнюю версию (которую можно было бы вставить в статью). </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Посему топаем <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk-7u4-downloads-1591156.html"><span style=" text-decoration: underline; color:#0000ff;">сюда</span></a> Тут валяется версия 7u4.<br />По-хорошему нужно пойти <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html"><span style=" text-decoration: underline; color:#0000ff;">сюда</span></a>, и ткнуть «download» под нужной версией. Короче, ужас. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Скачать нам оттуда нужно файл jdk-7u4-linux-x64.tar.gz или jdk-7u4-linux-i586.tar.gz (ну или новее, соответственно, если найдете). Ну и не забыть найти и выбрать пункт «Accept License Agreement» в уродской бестолковой верстке сайта. Эти полудурки ещё и добавили GET параметр к ссылке в виде… эээ… куска от куки, без которого скачать этот файл не получится (короче, вам обязательно понадобится браузер и хрена с 2 вы скачаете её из консольки сервера). </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда мы получим файл — можно наконец-то распрощаться с оракловым говносайтом и спокойно идти в консольку. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">У меня получился файл <span style=" font-weight:600;">jdk-7u4-linux-x64.tar.gz</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">user@host:~$ <span style=" font-weight:600;">tar -xvf jdk-7u4-linux-x64.tar.gz</span><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Положим это отродие в правильное с его точки зрения место: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">mv jdk1.7.0_04 /usr/lib/jvm/</span><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Создадим переменную, чтобы мануал остался универсальным для любых версий (потом всё следует делать в том же терминале): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">jdir=jdk1.7.0_04</span><br /># здесь после равно нужно указать название каталога, которому мы делали mv<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь создадим правильные симлинки внутри системы: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/$jdir/bin/javac 1</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">update-alternatives --install /usr/bin/java java /usr/lib/jvm/$jdir/bin/java 1</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">update-alternatives --install /usr/bin/javaws javaws /usr/lib/jvm/$jdir/bin/javaws 1</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">update-alternatives --install /usr/bin/jar jar /usr/lib/jvm/$jdir/bin/jar 1</span><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь самое время убедить нашу убунту в том, что следует использовать именно 7ю jdk, которую мы только что «установили». Если других версий jdk вы не ставили — то вам просто для успокоения совести следует ввести следующие 3 команды. Если ставили — то нам зададут всякие глупые вопросы. На них придется ответить: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">update-alternatives --config javac</span><br />There are 2 choices for the alternative javac (providing /usr/bin/javac).<br /><br />Selection Path Priority Status<br />------------------------------------------------------------<br />* 0 /usr/lib/jvm/java-7-openjdk-amd64/bin/javac 1051 auto mode<br />1 /usr/lib/jvm/java-7-openjdk-amd64/bin/javac 1051 manual mode<br />2 /usr/lib/jvm/jdk1.7.0_04/bin/javac 1 manual mode<br /><br />Press enter to keep the current choice[*], or type selection number: <span style=" font-weight:600;">2</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">update-alternatives --config java</span><br />There are 2 choices for the alternative java (providing /usr/bin/java).<br /><br />Selection Path Priority Status<br />------------------------------------------------------------<br />* 0 /usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java 1051 auto mode<br />1 /usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java 1051 manual mode<br />2 /usr/lib/jvm/jdk1.7.0_04/bin/java 1 manual mode<br /><br />Press enter to keep the current choice[*], or type selection number: <span style=" font-weight:600;">2</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">update-alternatives --config javaws</span><br />There is only one alternative in link group javaws: /usr/lib/jvm/jdk1.7.0_04/bin/javaws<br />Nothing to configure.<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">update-alternatives --config jar</span><br />...<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как выбрать циферку, думаю, всем понятно =)<br />Теперь проверим, что мы всё настроили верно: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">user@host:~$ <span style=" font-weight:600;">ls -la /etc/alternatives/{java,javac,javaws,jar}</span><br />lrwxrwxrwx 1 root root 33 May 23 01:40 /etc/alternatives/java -&gt; /usr/lib/jvm/jdk1.7.0_04/bin/java<br />lrwxrwxrwx 1 root root 34 May 23 01:39 /etc/alternatives/javac -&gt; /usr/lib/jvm/jdk1.7.0_04/bin/javac<br />lrwxrwxrwx 1 root root 35 May 23 00:29 /etc/alternatives/javaws -&gt; /usr/lib/jvm/jdk1.7.0_04/bin/javaws<br />...<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">user@host:~$ <span style=" font-weight:600;">java -version</span><br />java version &quot;1.7.0_04&quot;<br />Java(TM) SE Runtime Environment (build 1.7.0_04-b20)<br />Java HotSpot(TM) 64-Bit Server VM (build 23.0-b21, mixed mode)<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ну и осталась мелочь — рассказать нашим браузерам, что у нас есть java-плагин к ним (это актуально почти для всех браузеров, для FF и Chrome/Iron/Chromium — точно): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">root@host:~# <span style=" font-weight:600;">username=set_your_username_here; su ${username} -c &quot;mkdir ~${username}/.mozilla/plugins&quot;; rm /home/${username}/.mozilla/plugins/libnpjp2.so; su ${username} -c &quot;ln -s /usr/lib/jvm/$jdir/jre/lib/amd64/libnpjp2.so ~${username}/.mozilla/plugins/&quot;</span><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Проверить, что оно заработало можно <a href="http://www.java.com/en/download/testjava.jsp"><span style=" text-decoration: underline; color:#0000ff;">здесь</span></a>.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Я бы ещё по вкусу назначил на файлы *.jnlp ассоциацию с javawc, но это уже отдельная история (собственно, jnlp только через javawc и откроется). </p></body></html>